version: '2.1'

services:

  # Service definition for Consul cluster with a minimum of 3 nodes.
  # For local development we use Compose v2 so that we have an automatically
  # created user-defined network and internal DNS for the name "consul".
  # Nodes will use Docker DNS for the service (passed in via the CONSUL
  # env var) to find each other and bootstrap the cluster.
  # Note: Unless CONSUL_DEV is set, at least three instances are required for quorum.
  consul:
    image: autopilotpattern/consul:${TAG:-latest}
    restart: always
    mem_limit: 128m
    ports:
        - 8500
        - 8501
    environment:
      - CONSUL=consul
      - CONSUL_DATACENTER_NAME=dc1
      # The following variables can be used for HTTPS, RPC and gossip encryption
      - CONSUL_TLS_PATH=
      - CONSUL_ENCRYPT=
      # see etc/consul-manage
      - CONSUL_TLS_PRIVATE_HTTP=

    command: >
      /usr/local/bin/containerpilot
